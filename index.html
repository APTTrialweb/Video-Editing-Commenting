<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Video Review â€” GoFile Proxy Enabled</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#0f1724;color:#e6eef8;margin:0;padding:20px}
    h1{color:#06b6d4}
    video{width:100%;max-width:800px;border-radius:8px;background:#000;margin-top:20px}
    input,button,textarea{font-family:inherit}
    input[type=text]{width:100%;padding:10px;border-radius:8px;border:none;margin-top:8px;margin-bottom:8px}
    button{background:#06b6d4;color:#042;padding:10px 16px;border:none;border-radius:8px;cursor:pointer;font-weight:bold}
    button.ghost{background:transparent;border:1px solid #06b6d4;color:#06b6d4}
    .comment-box{margin-top:20px}
    textarea{width:100%;height:70px;border-radius:8px;border:none;padding:10px;margin-top:8px}
    ul{list-style:none;padding:0;margin:0;margin-top:10px}
    li{background:#152238;padding:8px;border-radius:8px;margin-bottom:6px}
    .time-link{color:#06b6d4;cursor:pointer;text-decoration:underline}
  </style>
</head>
<body>
  <h1>DIY Video Review (GoFile Proxy Enabled)</h1>
  <p>Paste your <strong>GoFile</strong> link or any direct video URL below. The app will automatically use a CORS proxy for playback if needed.</p>
  <input id="videoURL" type="text" placeholder="Paste direct .mp4 link or GoFile /d/... link here">
  <button id="btnLoad">Load Video</button>

  <video id="video" controls></video>

  <div class="comment-box">
    <h3>Add Comment</h3>
    <textarea id="commentText" placeholder="Type comment..."></textarea>
    <button id="btnAdd">Add Comment at Current Time</button>
  </div>

  <h3>Comments</h3>
  <ul id="commentList"></ul>

  <script>
    const video = document.getElementById('video');
    const videoURL = document.getElementById('videoURL');
    const btnLoad = document.getElementById('btnLoad');
    const commentText = document.getElementById('commentText');
    const btnAdd = document.getElementById('btnAdd');
    const commentList = document.getElementById('commentList');

    // Detect GoFile links and use proxy
    function makePlayableURL(url){
      if(!url) return '';
      let finalURL = url.trim();
      if(finalURL.includes('gofile.io/d/')){
        // Extract ID
        const id = finalURL.split('/d/')[1]?.split(/[/?#]/)[0];
        if(id){
          // Use GoFile API to fetch file info via proxy
          finalURL = `https://corsproxy.io/?https://api.gofile.io/getContent?contentId=${id}`;
          fetch(finalURL)
            .then(r=>r.json())
            .then(data=>{
              if(data.status==='ok' && data.data && data.data.contents){
                const files = Object.values(data.data.contents);
                const firstFile = files.find(f=>f.link?.endsWith('.mp4')) || files[0];
                if(firstFile){
                  const playable = `https://corsproxy.io/?${firstFile.link}`;
                  video.src = playable;
                  video.load();
                } else alert('No playable .mp4 found in this GoFile folder');
              } else alert('Could not fetch GoFile data');
            })
            .catch(()=>alert('Error fetching GoFile data'));
          return '';
        }
      }
      // If normal GoFile direct link, wrap with proxy if blocked
      if(finalURL.includes('store') && finalURL.includes('gofile.io')){
        finalURL = `https://corsproxy.io/?${finalURL}`;
      }
      return finalURL;
    }

    btnLoad.addEventListener('click', ()=>{
      const url = videoURL.value.trim();
      const playable = makePlayableURL(url);
      if(playable){
        video.src = playable;
        video.load();
      }
    });

    // Commenting system (localStorage)
    function key(){return 'review:'+(video.src||videoURL.value);}
    function loadComments(){try{return JSON.parse(localStorage.getItem(key())||'[]');}catch(e){return []}}
    function saveComments(arr){localStorage.setItem(key(),JSON.stringify(arr));}

    function renderComments(){
      const comments = loadComments();
      commentList.innerHTML = '';
      comments.sort((a,b)=>a.time-b.time);
      for(const c of comments){
        const li=document.createElement('li');
        li.innerHTML=`<span class='time-link' data-time='${c.time}'>${c.time.toFixed(1)}s</span> - ${c.text}`;
        commentList.appendChild(li);
      }
    }

    btnAdd.addEventListener('click', ()=>{
      if(!video.src){alert('Load a video first');return;}
      const t=video.currentTime;
      const txt=commentText.value.trim();
      if(!txt)return;
      const arr=loadComments();
      arr.push({time:t,text:txt});
      saveComments(arr);
      commentText.value='';
      renderComments();
    });

    commentList.addEventListener('click', e=>{
      if(e.target.classList.contains('time-link')){
        const t=parseFloat(e.target.dataset.time);
        video.currentTime=t;
        video.play();
      }
    });

    renderComments();
  </script>
</body>
</html>
